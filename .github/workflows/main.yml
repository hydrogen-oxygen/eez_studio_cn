name: Build/release

on: push

jobs:
  release:
    runs-on: ${{ matrix.os }}

    # Platforms to build on/for
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-22.04, windows-2019]

    steps:
      - name: Check out Git repository
        uses: actions/checkout@v3

      - name: Install Node.js (and optionally cache)
        uses: actions/setup-node@v3
        with:
          node-version: 16

      # If you need Yarn you can install it explicitly, for example:
      # - name: Install Yarn
      #   run: npm install -g yarn

      - name: Additional step from macOS
        if: startsWith(matrix.os, 'macos')
        run: sudo -H pip install setuptools

      - name: Additional step for ubuntu
        if: startsWith(matrix.os, 'ubuntu')
        run: sudo apt-get update -y && sudo apt-get install -y libudev-dev

      # optional: install project dependencies before building (uncomment if needed)
      # - name: Install dependencies
      #   run: |
      #     npm ci
      #     # or: yarn install --frozen-lockfile

      - name: Build/release Electron app
        uses: coparse-inc/action-electron-builder@v1.0.0
        with:
          # 使用 GitHub 提供的 token（注意大小写）
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # 如果 action 文档要求布尔值，使用 true/false
          release: true
        #env:
        #  API_KEY_ID: ${{ secrets.api_key_id }}
        #  API_KEY_ISSUER_ID: ${{ secrets.api_key_issuer_id }}

      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: eez-studio-${{ runner.os }}
          path: dist
